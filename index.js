(function(J,c,F,i,G,_,y,h,Y,V){"use strict";const ce=F.findByProps("openLazy","hideActionSheet"),{FormRow:Be,FormIcon:De}=y.Forms,Le=/^```(?:json)\n([\s\S]*?)```$/gm,ie=_.getAssetIDByName("ic_download_24px");function Oe(){return G.before("openLazy",ce,function(e){let[t,r]=e;r==="MessageLongPressActionSheet"&&t.then(function(a){const n=G.after("default",a,function(f,l){let[{message:g}]=f;i.React.useEffect(function(){return function(){n()}},[]);const m=g.content.match(Le)?.map(function(s){return s.slice(7,s.length-3)}).map(function(s){try{return JSON.parse(s)}catch{return}}).filter(function(s){return s}).filter(function(s){return typeof s.name=="string"&&s.name&&typeof s.match=="string"&&typeof s.replace=="string"&&typeof s.flags=="string"&&typeof s.regex=="boolean"});if(!m||m.length==0)return;let b=l?.props?.children?.props?.children?.props?.children[1];for(const s of m){const o=function(){c.storage.rules.push(s),h.showToast(`Imported rule ${s.name}`,ie),ce.hideActionSheet()},d=i.React.createElement(Be,{leading:i.React.createElement(De,{style:{opacity:1},source:ie}),label:`Import ${s.name}`,onPress:o});b.unshift(d)}})})})}const Je=F.findByProps("sendMessage","receiveMessage"),Ge=_.getAssetIDByName("ic_warning_24px");function Ye(){return G.before("sendMessage",Je,function(e){const t=c.storage.rules.filter(function(a){return a.match});let r=e[1].content;for(const a of t)if(a.regex)try{const n=new RegExp(a.match,a.flags);r=r.replace(n,a.replace)}catch(n){console.log(n),h.showToast(`Failed to use RegExp for ${a.name}!`,Ge);continue}else r=r.replaceAll(a.match,a.replace);e[1].content=r})}const{TouchableOpacity:He}=y.General,{FormIcon:je}=y.Forms,qe=_.getAssetIDByName("ic_add_24px");function Ke(e){let{onPress:t}=e;return React.createElement(He,{onPress:t},React.createElement(je,{source:qe,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:Xe}=y.General,{FormSection:I,FormInput:B,FormDivider:se,FormSwitchRow:We,FormRow:ue,FormLabel:Qe}=y.Forms,Ze=_.getAssetIDByName("ic_message_copy"),et=i.stylesheet.createThemedStyleSheet({delete:{color:V.rawColors.RED_400}});function de(e){let{ruleIndex:t}=e,r=c.storage.rules[t];Y.useProxy(c.storage);const a=i.NavigationNative.useNavigation(),n=function(){const l=`\`\`\`json
${JSON.stringify(r,null,4)}
\`\`\``;i.clipboard.setString(l),h.showToast(`Copied ${r.name} to Clipboard`,Ze)},f=function(){c.storage.rules.splice(t,1),a.pop()};return React.createElement(Xe,null,React.createElement(I,null,React.createElement(B,{value:r?.name,onChange:function(l){return r.name=l},placeholder:"New rule",title:"Name"})),React.createElement(I,null,React.createElement(B,{value:r?.match,onChange:function(l){return r.match=l},placeholder:"foo",title:"Match"}),r?.regex&&React.createElement(React.Fragment,null,React.createElement(se,null),React.createElement(B,{title:"Flags",placeholder:"gi",value:r?.flags,onChange:function(l){return r.flags=l}})),React.createElement(se,null),React.createElement(B,{value:r?.replace,onChange:function(l){return r.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(I,null,React.createElement(We,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:r?.regex,onValueChange:function(l){return r.regex=l}})),React.createElement(I,null,React.createElement(ue,{label:"Copy code block to Clipboard",onPress:n})),React.createElement(I,null,React.createElement(ue,{label:React.createElement(Qe,{text:"Delete Rule",style:et.delete}),onPress:f})))}const{FormRow:tt,FormArrow:rt}=y.Forms;function nt(e){let{rule:t,index:r}=e;const a=i.NavigationNative.useNavigation();return React.createElement(tt,{label:t.name,trailing:React.createElement(rt,null),onPress:function(){return a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(de,{ruleIndex:r})}})}})}const at=F.findByStoreName("UserStore"),{pushModal:ot,popModal:lt}=F.findByProps("pushModal","popModal"),H=function(){return new URL(c.storage.vencordCloudSyncSettings.backendUrl)},fe=function(){return H().origin},j=function(){const e=at.getCurrentUser()?.id;if(!e)throw new Error("User not yet logged in");return e};async function ge(){const e=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{},t=fe();return e[`${t}:${j()}`]}async function ct(e){const t=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{};return t[`${fe()}:${j()}`]=e,t}async function it(){if(await ge()!==void 0){console.debug("authorizeCloud() | getAuthorization() returned value"),c.storage.vencordCloudSyncSettings.authenticated=!0;return}try{const a=await fetch(new URL("/v1/oauth/settings",H()));var{clientId:e,redirectUri:t}=await a.json();console.debug("authorizeCloud() | clientId: ",e," ; redirectUri: ",t)}catch(a){console.error(a),h.showToast("Cloud Integration: Setup failed (couldn't retrieve OAuth configuration)."),c.storage.vencordCloudSyncSettings.authenticated=!1;return}const r=F.findByName("OAuth2AuthorizeModal");ot({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:r,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:e,redirectUri:t,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(a){let{location:n}=a;if(!n){console.debug("authorizeCloud() -> pushModal() -> callback | location is false/invalid"),c.storage.vencordCloudSyncSettings.authenticated=!1;return}try{const f=await fetch(n,{headers:new Headers({Accept:"application/json"})}),{secret:l}=await f.json();l?(console.info("Authorized with secret"),await ct(l),h.showToast("Cloud Integration: Cloud integrations enabled!"),c.storage.vencordCloudSyncSettings.authenticated=!0):(h.showToast("Cloud Integration: Setup failed (no secret returned?)."),c.storage.vencordCloudSyncSettings.authenticated=!1)}catch(f){console.error("Failed to authorize",f),h.showToast(`Cloud Integration: Setup failed (${f.toString()}).`),c.storage.vencordCloudSyncSettings.authenticated=!1}},dismissOAuthModal:function(){return lt("oauth2-authorize")}},closable:!0}})}async function st(){const e=await ge();return Buffer.from(`${e}:${j()}`).toString("base64")}var v=Uint8Array,x=Uint16Array,ut=Int32Array,he=new v([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ve=new v([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dt=new v([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Se=function(e,t){for(var r=new x(31),a=0;a<31;++a)r[a]=t+=1<<e[a-1];for(var n=new ut(r[30]),a=1;a<30;++a)for(var f=r[a];f<r[a+1];++f)n[f]=f-r[a]<<5|a;return{b:r,r:n}},ye=Se(he,2),pe=ye.b,ft=ye.r;pe[28]=258,ft[258]=28;for(var gt=Se(ve,0),ht=gt.b,q=new x(32768),u=0;u<32768;++u){var C=(u&43690)>>1|(u&21845)<<1;C=(C&52428)>>2|(C&13107)<<2,C=(C&61680)>>4|(C&3855)<<4,q[u]=((C&65280)>>8|(C&255)<<8)>>1}for(var N=function(e,t,r){for(var a=e.length,n=0,f=new x(t);n<a;++n)e[n]&&++f[e[n]-1];var l=new x(t);for(n=1;n<t;++n)l[n]=l[n-1]+f[n-1]<<1;var g;if(r){g=new x(1<<t);var m=15-t;for(n=0;n<a;++n)if(e[n])for(var b=n<<4|e[n],s=t-e[n],o=l[e[n]-1]++<<s,d=o|(1<<s)-1;o<=d;++o)g[q[o]>>m]=b}else for(g=new x(a),n=0;n<a;++n)e[n]&&(g[n]=q[l[e[n]-1]++]>>15-e[n]);return g},P=new v(288),u=0;u<144;++u)P[u]=8;for(var u=144;u<256;++u)P[u]=9;for(var u=256;u<280;++u)P[u]=7;for(var u=280;u<288;++u)P[u]=8;for(var me=new v(32),u=0;u<32;++u)me[u]=5;var vt=N(P,9,1),St=N(me,5,1),K=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},p=function(e,t,r){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(t&7)&r},X=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},yt=function(e){return(e+7)/8|0},pt=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new v(e.subarray(t,r))},mt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(e,t,r){var a=new Error(t||mt[e]);if(a.code=e,Error.captureStackTrace&&Error.captureStackTrace(a,R),!r)throw a;return a},wt=function(e,t,r,a){var n=e.length,f=a?a.length:0;if(!n||t.f&&!t.l)return r||new v(0);var l=!r,g=l||t.i!=2,m=t.i;l&&(r=new v(n*3));var b=function(Me){var _e=r.length;if(Me>_e){var Ve=new v(Math.max(_e*2,Me));Ve.set(r),r=Ve}},s=t.f||0,o=t.p||0,d=t.b||0,T=t.l,L=t.d,U=t.m,k=t.n,Q=n*8;do{if(!T){s=p(e,o,1);var Z=p(e,o+1,3);if(o+=3,Z)if(Z==1)T=vt,L=St,U=9,k=5;else if(Z==2){var re=p(e,o,31)+257,$e=p(e,o+10,15)+4,Ae=re+p(e,o+5,31)+1;o+=14;for(var z=new v(Ae),ne=new v(19),S=0;S<$e;++S)ne[dt[S]]=p(e,o+S*3,7);o+=$e*3;for(var Ie=K(ne),Bt=(1<<Ie)-1,Dt=N(ne,Ie,1),S=0;S<Ae;){var Ne=Dt[p(e,o,Bt)];o+=Ne&15;var w=Ne>>4;if(w<16)z[S++]=w;else{var $=0,O=0;for(w==16?(O=3+p(e,o,3),o+=2,$=z[S-1]):w==17?(O=3+p(e,o,7),o+=3):w==18&&(O=11+p(e,o,127),o+=7);O--;)z[S++]=$}}var Pe=z.subarray(0,re),E=z.subarray(re);U=K(Pe),k=K(E),T=N(Pe,U,1),L=N(E,k,1)}else R(1);else{var w=yt(o)+4,ee=e[w-4]|e[w-3]<<8,te=w+ee;if(te>n){m&&R(0);break}g&&b(d+ee),r.set(e.subarray(w,te),d),t.b=d+=ee,t.p=o=te*8,t.f=s;continue}if(o>Q){m&&R(0);break}}g&&b(d+131072);for(var Lt=(1<<U)-1,Ot=(1<<k)-1,ae=o;;ae=o){var $=T[X(e,o)&Lt],A=$>>4;if(o+=$&15,o>Q){m&&R(0);break}if($||R(2),A<256)r[d++]=A;else if(A==256){ae=o,T=null;break}else{var Ue=A-254;if(A>264){var S=A-257,M=he[S];Ue=p(e,o,(1<<M)-1)+pe[S],o+=M}var oe=L[X(e,o)&Ot],le=oe>>4;oe||R(3),o+=oe&15;var E=ht[le];if(le>3){var M=ve[le];E+=X(e,o)&(1<<M)-1,o+=M}if(o>Q){m&&R(0);break}g&&b(d+131072);var ke=d+Ue;if(d<E){var ze=f-E,Jt=Math.min(E,ke);for(ze+d<0&&R(3);d<Jt;++d)r[d]=a[ze+d]}for(;d<ke;++d)r[d]=r[d-E]}}t.l=T,t.p=ae,t.b=d,t.f=s,T&&(s=1,t.m=U,t.d=L,t.n=k)}while(!s);return d!=r.length&&l?pt(r,0,d):r.subarray(0,d)},Rt=new v(0);function Ct(e,t){return wt(e,{i:2},t&&t.out,t&&t.dictionary)}var Et=typeof TextDecoder<"u"&&new TextDecoder,bt=0;try{Et.decode(Rt,{stream:!0}),bt=1}catch{}function D(e,t){return e.length>t?e.slice(0,t)+"...":e}function Tt(e){const t="TextReplace_rulesString",r="TextReplace_rulesRegex";let a=[];return console.debug("vencordRules:"+JSON.stringify(e)),e[t].forEach(function(n){n.find!==""&&n.replace!==""&&a.push({name:D(n.find,20)+" \u2192 "+D(n.replace,20),match:n.find,flags:"",replace:n.replace,regex:!1})}),e[r].forEach(function(n){const f=/^(.*)\/([a-z]+)$/,l=n.find.match(f);let g="";l&&(g=l[2]),n.find!==""&&n.replace!==""&&a.push({name:D(n.find,20)+" \u2192 "+D(n.replace,20),match:n.find,flags:g,replace:n.replace,regex:!0})}),console.debug("vendettaRules:"+JSON.stringify(a)),a}function Ft(e){try{var t=JSON.parse(e)}catch(a){throw console.log(e),new Error("Failed to parse JSON: "+String(a))}let r;if("settings"in t&&"quickCss"in t)if("plugins"in t.settings&&"TextReplace"in t.settings.plugins)if("rules"in t.settings.plugins.TextReplace)r=t.settings.plugins.TextReplace.rules,c.storage.rules=Tt(r);else throw new Error("There are no TextReplace rules stored in the Vencord Cloud Settings of this user account.");else throw new Error("TextReplace could not be found in the Vencord Cloud Settings.");else throw new Error("Invalid Settings. Is this even a Vencord Settings file?")}async function xt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{console.debug("Start getting cloud settings...");const r=await fetch(new URL("/v1/settings",H()),{method:"GET",headers:new Headers({Authorization:await st(),Accept:"application/octet-stream","If-None-Match":t?"":c.storage.vencordCloudSyncSettings.syncVersion.toString()})});if(console.debug("vencordCloud/v1/settings response: ",r),r.status===404)return console.info("No settings on the cloud"),e&&h.showToast("Cloud Settings: There are no settings in the cloud."),!1;if(r.status===304)return console.info("Settings up to date"),e&&h.showToast("Cloud Settings: Your settings are up to date."),!1;if(!r.ok)return console.error(`Failed to sync down, API returned ${r.status}`),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (API returned ${r.status}).`),!1;const a=Number(r.headers.get("etag")),n=c.storage.vencordCloudSyncSettings.syncVersion;if(!t&&a<n){e&&h.showToast("Cloud Settings: Your local settings are newer than the cloud ones.");return}const f=await r.arrayBuffer(),l=new TextDecoder().decode(Ct(new Uint8Array(f)));return Ft(l),c.storage.vencordCloudSyncSettings.syncVersion=a,console.info("Settings loaded from cloud successfully"),e&&h.showToast("Cloud Settings: Your settings have been updated!"),!0}catch(r){return console.error("Failed to sync down",r),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (${r.toString()}).`),!1}}const{ScrollView:$t}=y.General,{FormSection:W,FormInput:At,FormDivider:we,FormSwitchRow:It,FormRow:Re}=y.Forms,Ce=i.stylesheet.createThemedStyleSheet({dangerButton:{backgroundColor:V.rawColors.RED_400,marginHorizontal:16},inputLabel:{marginTop:-40}});function Nt(){return{authenticated:!1,backendUrl:"https://api.vencord.dev/",syncVersion:0,vencordCloudSecret:{}}}function Pt(){return c.storage.vencordCloudSyncSettings===void 0&&(c.storage.vencordCloudSyncSettings=Nt()),Y.useProxy(c.storage),React.createElement($t,null,React.createElement(W,null,React.createElement(It,{label:"Enable Cloud Integrations",value:c.storage.vencordCloudSyncSettings.authenticated,onValueChange:function(e){e?it():c.storage.vencordCloudSyncSettings.authenticated=e},subLabel:"This will request authorization if you have not yet set up cloud integrations."})),React.createElement(W,null,React.createElement(we,null),React.createElement(At,{value:c.storage.vencordCloudSyncSettings.backendUrl,onChange:function(e){return c.storage.vencordCloudSyncSettings.backendUrl=e},title:"Backend URL"}),React.createElement(Re,{subLabel:"Which backend to use when using cloud integrations.",style:Ce.inputLabel})),React.createElement(W,null,React.createElement(we,null),React.createElement(Re,{label:"This will overwrite your local settings with the ones on the cloud. Use wisely!"}),React.createElement(y.Button,{style:Ce.dangerButton,text:"Sync from Cloud",disabled:!c.storage.vencordCloudSyncSettings.authenticated,onPress:function(){console.debug("'Sync from Cloud' pressed"),xt(!0,!0)}},"Sync from Cloud")))}const{ScrollView:Ut,TextInput:kt}=y.General,{FormRow:Ee,FormSection:be,FormDivider:Te,FormArrow:zt}=y.Forms,Fe=i.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:i.constants.Fonts.PRIMARY_MEDIUM,color:V.semanticColors.TEXT_NORMAL},placeholder:{color:V.semanticColors.INPUT_PLACEHOLDER_TEXT}}),Mt=F.findByName("useIsFocused");function _t(){const[e,t]=i.React.useState("");let r=c.storage.rules;Y.useProxy(c.storage);const a=i.NavigationNative.useNavigation();Mt();const n=function(){e&&(r.push({name:e.trim(),match:"",flags:"gi",replace:"",regex:!1}),t(""),a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return i.React.createElement(de,{ruleIndex:r.length-1})}}))},f=function(){a.push("VendettaCustomPage",{title:"Vencord TextReplace Cloud Sync",render:function(){return i.React.createElement(Pt,null)}})};return i.React.createElement(Ut,null,i.React.createElement(be,{title:"Import/export rules"},i.React.createElement(Ee,{label:"Vencord TextReplace Cloud Sync Settings",onPress:f,trailing:i.React.createElement(zt,null)}),i.React.createElement(Te,null)),i.React.createElement(be,{title:"Rules"},r.map(function(l,g){return i.React.createElement(i.React.Fragment,null,i.React.createElement(nt,{rule:l,index:g}),i.React.createElement(Te,null))}),i.React.createElement(Ee,{label:i.React.createElement(kt,{value:e,onChangeText:t,placeholder:"New rule",placeholderTextColor:Fe.placeholder.color,selectionColor:i.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:n,returnKeyType:"done",style:Fe.input}),trailing:i.React.createElement(Ke,{onPress:n})})))}let xe;var Vt={onLoad:function(){var e;(e=c.storage).rules??(e.rules=[]),xe=[Ye(),Oe()]},onUnload:function(){for(const e of xe)e()},settings:_t};return J.default=Vt,Object.defineProperty(J,"__esModule",{value:!0}),J})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.storage,vendetta.ui);
