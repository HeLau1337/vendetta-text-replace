(function(G,c,C,i,Y,B,h,Le,I,j,S){"use strict";const{ActionSheetRow:H}=C.findByProps("ActionSheetRow"),{FormRow:ie}=C.findByProps("FormRow");function Oe(e){let{label:t,icon:n,onPress:a}=e;const r=i.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:I.semanticColors.INTERACTIVE_NORMAL}});return H?React.createElement(H,{label:t,icon:React.createElement(H.Icon,{source:n,IconComponent:function(){return React.createElement(i.ReactNative.Image,{resizeMode:"cover",style:r.iconComponent,source:n})}}),onPress:a}):React.createElement(ie,{label:t,leading:React.createElement(ie.Icon,{source:n}),onPress:a})}const se=C.findByProps("openLazy","hideActionSheet"),Ge=/^```(?:json)\n([\s\S]*?)```$/gm,ue=B.getAssetIDByName("ic_download_24px");function Ye(){return Y.before("openLazy",se,function(e){let[t,n]=e;n==="MessageLongPressActionSheet"&&t.then(function(a){const r=Y.after("default",a,function(f,l){let[{message:g}]=f;i.React.useEffect(function(){return function(){r()}},[]);const v=g.content.match(Ge)?.map(function(s){return s.slice(7,s.length-3)}).map(function(s){try{return JSON.parse(s)}catch{return}}).filter(function(s){return s}).filter(function(s){return typeof s.name=="string"&&s.name&&typeof s.match=="string"&&typeof s.replace=="string"&&typeof s.flags=="string"&&typeof s.regex=="boolean"});if(!v||v.length==0)return;const b=Le.findInReactTree(l,function(s){return s?.[0]?.type?.name==="ButtonRow"});if(b)for(const s of v){const o=function(){c.storage.rules.push(s),h.showToast(`Imported rule ${s.name}`,ue),se.hideActionSheet()},d=i.React.createElement(Oe,{icon:ue,label:`Import ${s.name}`,onPress:o});b.unshift(d)}})})})}const je=C.findByProps("sendMessage","receiveMessage"),He=B.getAssetIDByName("ic_warning_24px");function Je(){return Y.before("sendMessage",je,function(e){const t=c.storage.rules.filter(function(a){return a.match});let n=e[1].content;for(const a of t)if(a.regex)try{const r=new RegExp(a.match,a.flags);n=n.replace(r,a.replace)}catch(r){console.log(r),h.showToast(`Failed to use RegExp for ${a.name}!`,He);continue}else n=n.replaceAll(a.match,a.replace);e[1].content=n})}const{TouchableOpacity:qe}=S.General,{FormIcon:Ke}=S.Forms,Xe=B.getAssetIDByName("ic_add_24px");function We(e){let{onPress:t}=e;return React.createElement(qe,{onPress:t},React.createElement(Ke,{source:Xe,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:Qe}=S.General,{FormSection:N,FormInput:V,FormDivider:de,FormSwitchRow:Ze,FormRow:fe,FormLabel:et}=S.Forms,tt=B.getAssetIDByName("ic_message_copy"),nt=i.stylesheet.createThemedStyleSheet({delete:{color:I.rawColors.RED_400}});function ge(e){let{ruleIndex:t}=e,n=c.storage.rules[t];j.useProxy(c.storage);const a=i.NavigationNative.useNavigation(),r=function(){const l=`\`\`\`json
${JSON.stringify(n,null,4)}
\`\`\``;i.clipboard.setString(l),h.showToast(`Copied ${n.name} to Clipboard`,tt)},f=function(){c.storage.rules.splice(t,1),a.pop()};return React.createElement(Qe,null,React.createElement(N,null,React.createElement(V,{value:n?.name,onChange:function(l){return n.name=l},placeholder:"New rule",title:"Name"})),React.createElement(N,null,React.createElement(V,{value:n?.match,onChange:function(l){return n.match=l},placeholder:"foo",title:"Match"}),n?.regex&&React.createElement(React.Fragment,null,React.createElement(de,null),React.createElement(V,{title:"Flags",placeholder:"gi",value:n?.flags,onChange:function(l){return n.flags=l}})),React.createElement(de,null),React.createElement(V,{value:n?.replace,onChange:function(l){return n.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(N,null,React.createElement(Ze,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:n?.regex,onValueChange:function(l){return n.regex=l}})),React.createElement(N,null,React.createElement(fe,{label:"Copy code block to Clipboard",onPress:r})),React.createElement(N,null,React.createElement(fe,{label:React.createElement(et,{text:"Delete Rule",style:nt.delete}),onPress:f})))}const{FormRow:rt,FormArrow:at}=S.Forms;function ot(e){let{rule:t,index:n}=e;const a=i.NavigationNative.useNavigation();return React.createElement(rt,{label:t.name,trailing:React.createElement(at,null),onPress:function(){return a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(ge,{ruleIndex:n})}})}})}const lt=C.findByStoreName("UserStore"),{pushModal:ct,popModal:it}=C.findByProps("pushModal","popModal"),J=function(){return new URL(c.storage.vencordCloudSyncSettings.backendUrl)},he=function(){return J().origin},q=function(){const e=lt.getCurrentUser()?.id;if(!e)throw new Error("User not yet logged in");return e};async function ve(){const e=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{},t=he();return e[`${t}:${q()}`]}async function st(e){const t=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{};return t[`${he()}:${q()}`]=e,t}async function ut(){if(await ve()!==void 0){c.storage.vencordCloudSyncSettings.authenticated=!0;return}try{const a=await fetch(new URL("/v1/oauth/settings",J()));var{clientId:e,redirectUri:t}=await a.json()}catch(a){console.error(a),h.showToast("Cloud Integration: Setup failed (couldn't retrieve OAuth configuration)."),c.storage.vencordCloudSyncSettings.authenticated=!1;return}const n=C.findByName("OAuth2AuthorizeModal");ct({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:n,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:e,redirectUri:t,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(a){let{location:r}=a;if(!r){c.storage.vencordCloudSyncSettings.authenticated=!1;return}try{const f=await fetch(r,{headers:new Headers({Accept:"application/json"})}),{secret:l}=await f.json();l?(console.info("Authorized with secret"),await st(l),h.showToast("Cloud Integration: Cloud integrations enabled!"),c.storage.vencordCloudSyncSettings.authenticated=!0):(h.showToast("Cloud Integration: Setup failed (no secret returned?)."),c.storage.vencordCloudSyncSettings.authenticated=!1)}catch(f){console.error("Failed to authorize",f),h.showToast(`Cloud Integration: Setup failed (${f.toString()}).`),c.storage.vencordCloudSyncSettings.authenticated=!1}},dismissOAuthModal:function(){return it("oauth2-authorize")}},closable:!0}})}async function dt(){const e=await ve();return Buffer.from(`${e}:${q()}`).toString("base64")}var y=Uint8Array,F=Uint16Array,ft=Int32Array,ye=new y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Re=new y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gt=new y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),me=function(e,t){for(var n=new F(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];for(var r=new ft(n[30]),a=1;a<30;++a)for(var f=n[a];f<n[a+1];++f)r[f]=f-n[a]<<5|a;return{b:n,r}},Se=me(ye,2),we=Se.b,ht=Se.r;we[28]=258,ht[258]=28;for(var vt=me(Re,0),yt=vt.b,K=new F(32768),u=0;u<32768;++u){var E=(u&43690)>>1|(u&21845)<<1;E=(E&52428)>>2|(E&13107)<<2,E=(E&61680)>>4|(E&3855)<<4,K[u]=((E&65280)>>8|(E&255)<<8)>>1}for(var P=function(e,t,n){for(var a=e.length,r=0,f=new F(t);r<a;++r)e[r]&&++f[e[r]-1];var l=new F(t);for(r=1;r<t;++r)l[r]=l[r-1]+f[r-1]<<1;var g;if(n){g=new F(1<<t);var v=15-t;for(r=0;r<a;++r)if(e[r])for(var b=r<<4|e[r],s=t-e[r],o=l[e[r]-1]++<<s,d=o|(1<<s)-1;o<=d;++o)g[K[o]>>v]=b}else for(g=new F(a),r=0;r<a;++r)e[r]&&(g[r]=K[l[e[r]-1]++]>>15-e[r]);return g},M=new y(288),u=0;u<144;++u)M[u]=8;for(var u=144;u<256;++u)M[u]=9;for(var u=256;u<280;++u)M[u]=7;for(var u=280;u<288;++u)M[u]=8;for(var pe=new y(32),u=0;u<32;++u)pe[u]=5;var Rt=P(M,9,1),mt=P(pe,5,1),X=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},m=function(e,t,n){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(t&7)&n},W=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},St=function(e){return(e+7)/8|0},wt=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new y(e.subarray(t,n))},pt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(e,t,n){var a=new Error(t||pt[e]);if(a.code=e,Error.captureStackTrace&&Error.captureStackTrace(a,p),!n)throw a;return a},Ct=function(e,t,n,a){var r=e.length,f=a?a.length:0;if(!r||t.f&&!t.l)return n||new y(0);var l=!n,g=l||t.i!=2,v=t.i;l&&(n=new y(r*3));var b=function(Be){var Ve=n.length;if(Be>Ve){var De=new y(Math.max(Ve*2,Be));De.set(n),n=De}},s=t.f||0,o=t.p||0,d=t.b||0,x=t.l,L=t.d,U=t.m,k=t.n,Z=r*8;do{if(!x){s=m(e,o,1);var ee=m(e,o+1,3);if(o+=3,ee)if(ee==1)x=Rt,L=mt,U=9,k=5;else if(ee==2){var re=m(e,o,31)+257,Ie=m(e,o+10,15)+4,Ne=re+m(e,o+5,31)+1;o+=14;for(var _=new y(Ne),ae=new y(19),R=0;R<Ie;++R)ae[gt[R]]=m(e,o+R*3,7);o+=Ie*3;for(var Pe=X(ae),Lt=(1<<Pe)-1,Ot=P(ae,Pe,1),R=0;R<Ne;){var Me=Ot[m(e,o,Lt)];o+=Me&15;var w=Me>>4;if(w<16)_[R++]=w;else{var $=0,O=0;for(w==16?(O=3+m(e,o,3),o+=2,$=_[R-1]):w==17?(O=3+m(e,o,7),o+=3):w==18&&(O=11+m(e,o,127),o+=7);O--;)_[R++]=$}}var Ue=_.subarray(0,re),T=_.subarray(re);U=X(Ue),k=X(T),x=P(Ue,U,1),L=P(T,k,1)}else p(1);else{var w=St(o)+4,te=e[w-4]|e[w-3]<<8,ne=w+te;if(ne>r){v&&p(0);break}g&&b(d+te),n.set(e.subarray(w,ne),d),t.b=d+=te,t.p=o=ne*8,t.f=s;continue}if(o>Z){v&&p(0);break}}g&&b(d+131072);for(var Gt=(1<<U)-1,Yt=(1<<k)-1,oe=o;;oe=o){var $=x[W(e,o)&Gt],A=$>>4;if(o+=$&15,o>Z){v&&p(0);break}if($||p(2),A<256)n[d++]=A;else if(A==256){oe=o,x=null;break}else{var ke=A-254;if(A>264){var R=A-257,z=ye[R];ke=m(e,o,(1<<z)-1)+we[R],o+=z}var le=L[W(e,o)&Yt],ce=le>>4;le||p(3),o+=le&15;var T=yt[ce];if(ce>3){var z=Re[ce];T+=W(e,o)&(1<<z)-1,o+=z}if(o>Z){v&&p(0);break}g&&b(d+131072);var _e=d+ke;if(d<T){var ze=f-T,jt=Math.min(T,_e);for(ze+d<0&&p(3);d<jt;++d)n[d]=a[ze+d]}for(;d<_e;++d)n[d]=n[d-T]}}t.l=x,t.p=oe,t.b=d,t.f=s,x&&(s=1,t.m=U,t.d=L,t.n=k)}while(!s);return d!=n.length&&l?wt(n,0,d):n.subarray(0,d)},Et=new y(0);function bt(e,t){return Ct(e,{i:2},t&&t.out,t&&t.dictionary)}var Tt=typeof TextDecoder<"u"&&new TextDecoder,xt=0;try{Tt.decode(Et,{stream:!0}),xt=1}catch{}function D(e,t){return e.length>t?e.slice(0,t)+"...":e}function Ft(e){const t="TextReplace_rulesString",n="TextReplace_rulesRegex";let a=[];return e[t].forEach(function(r){r.find!==""&&r.replace!==""&&a.push({name:D(r.find,20)+" \u2192 "+D(r.replace,20),match:r.find,flags:"",replace:r.replace,regex:!1})}),e[n].forEach(function(r){const f=/(\/([a-z]+)(?<!\\\/[a-z]+))$/,l=r.find.match(f);let g="",v=r.find;l&&(g=l[1],v=r.find.split(g)[0],g=g.split("/")[1]),g.split("").includes("g")||(g=g+"g"),g=g.split("").sort().join(""),r.find!==""&&r.replace!==""&&a.push({name:D(r.find,20)+" \u2192 "+D(r.replace,20),match:v,flags:g,replace:r.replace,regex:!0})}),a}function $t(e){try{var t=JSON.parse(e)}catch(a){throw console.log(e),new Error("Failed to parse JSON: "+String(a))}let n;if("settings"in t&&"quickCss"in t)if("plugins"in t.settings&&"TextReplace"in t.settings.plugins)if("rules"in t.settings.plugins.TextReplace)n=t.settings.plugins.TextReplace.rules,c.storage.rules=Ft(n);else throw new Error("There are no TextReplace rules stored in the Vencord Cloud Settings of this user account.");else throw new Error("TextReplace could not be found in the Vencord Cloud Settings.");else throw new Error("Invalid Settings. Is this even a Vencord Settings file?")}async function At(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{const n=await fetch(new URL("/v1/settings",J()),{method:"GET",headers:new Headers({Authorization:await dt(),Accept:"application/octet-stream","If-None-Match":t?"":c.storage.vencordCloudSyncSettings.syncVersion.toString()})});if(n.status===404)return console.info("No settings on the cloud"),e&&h.showToast("Cloud Settings: There are no settings in the cloud."),!1;if(n.status===304)return console.info("Settings up to date"),e&&h.showToast("Cloud Settings: Your settings are up to date."),!1;if(!n.ok)return console.error(`Failed to sync down, API returned ${n.status}`),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (API returned ${n.status}).`),!1;const a=Number(n.headers.get("etag")),r=c.storage.vencordCloudSyncSettings.syncVersion;if(!t&&a<r){e&&h.showToast("Cloud Settings: Your local settings are newer than the cloud ones.");return}const f=await n.arrayBuffer(),l=new TextDecoder().decode(bt(new Uint8Array(f)));return $t(l),c.storage.vencordCloudSyncSettings.syncVersion=a,console.info("Settings loaded from cloud successfully"),e&&h.showToast("Cloud Settings: Your settings have been updated!"),!0}catch(n){return console.error("Failed to sync down",n),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (${n.toString()}).`),!1}}const{ScrollView:It}=S.General,{FormSection:Q,FormInput:Nt,FormDivider:Ce,FormSwitchRow:Pt,FormRow:Ee}=S.Forms,be=i.stylesheet.createThemedStyleSheet({dangerButton:{backgroundColor:I.rawColors.RED_400,marginHorizontal:16},inputLabel:{marginTop:-40}});function Mt(){return{authenticated:!1,backendUrl:"https://api.vencord.dev/",syncVersion:0,vencordCloudSecret:{}}}function Ut(){return c.storage.vencordCloudSyncSettings===void 0&&(c.storage.vencordCloudSyncSettings=Mt()),j.useProxy(c.storage),React.createElement(It,null,React.createElement(Q,null,React.createElement(Pt,{label:"Enable Cloud Integrations",value:c.storage.vencordCloudSyncSettings.authenticated,onValueChange:function(e){e?ut():c.storage.vencordCloudSyncSettings.authenticated=e},subLabel:"This will request authorization if you have not yet set up cloud integrations."})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Nt,{value:c.storage.vencordCloudSyncSettings.backendUrl,onChange:function(e){return c.storage.vencordCloudSyncSettings.backendUrl=e},title:"Backend URL"}),React.createElement(Ee,{subLabel:"Which backend to use when using cloud integrations.",style:be.inputLabel})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Ee,{label:"This will overwrite your local settings with the ones on the cloud. Use wisely!"}),React.createElement(S.Button,{style:be.dangerButton,text:"Sync from Cloud",disabled:!c.storage.vencordCloudSyncSettings.authenticated,onPress:function(){At(!0,!0)}},"Sync from Cloud")))}const{ScrollView:kt,TextInput:_t}=S.General,{FormRow:Te,FormSection:xe,FormDivider:Fe,FormArrow:zt}=S.Forms,$e=i.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:i.constants.Fonts.PRIMARY_MEDIUM,color:I.semanticColors.TEXT_NORMAL},placeholder:{color:I.semanticColors.INPUT_PLACEHOLDER_TEXT}}),Bt=C.findByName("useIsFocused");function Vt(){const[e,t]=i.React.useState("");let n=c.storage.rules;j.useProxy(c.storage);const a=i.NavigationNative.useNavigation();Bt();const r=function(){e&&(n.push({name:e.trim(),match:"",flags:"gi",replace:"",regex:!1}),t(""),a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return i.React.createElement(ge,{ruleIndex:n.length-1})}}))},f=function(){a.push("VendettaCustomPage",{title:"Vencord TextReplace Cloud Sync",render:function(){return i.React.createElement(Ut,null)}})};return i.React.createElement(kt,null,i.React.createElement(xe,{title:"Import/export rules"},i.React.createElement(Te,{label:"Vencord TextReplace Cloud Sync Settings",onPress:f,trailing:i.React.createElement(zt,null)}),i.React.createElement(Fe,null)),i.React.createElement(xe,{title:"Rules"},n.map(function(l,g){return i.React.createElement(i.React.Fragment,null,i.React.createElement(ot,{rule:l,index:g}),i.React.createElement(Fe,null))}),i.React.createElement(Te,{label:i.React.createElement(_t,{value:e,onChangeText:t,placeholder:"New rule",placeholderTextColor:$e.placeholder.color,selectionColor:i.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:r,returnKeyType:"done",style:$e.input}),trailing:i.React.createElement(We,{onPress:r})})))}let Ae;var Dt={onLoad:function(){var e;(e=c.storage).rules??(e.rules=[]),Ae=[Je(),Ye()]},onUnload:function(){for(const e of Ae)e()},settings:Vt};return G.default=Dt,Object.defineProperty(G,"__esModule",{value:!0}),G})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils,vendetta.ui,vendetta.storage,vendetta.ui.components);
