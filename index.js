(function(J,c,C,i,G,B,h,Le,$,Y,R){"use strict";const{ActionSheetRow:H}=C.findByProps("ActionSheetRow"),{FormRow:ie}=C.findByProps("FormRow");function Oe(e){let{label:t,icon:n,onPress:r}=e;const a=i.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:$.semanticColors.INTERACTIVE_NORMAL}});return H?React.createElement(H,{label:t,icon:React.createElement(H.Icon,{source:n,IconComponent:function(){return React.createElement(i.ReactNative.Image,{resizeMode:"cover",style:a.iconComponent,source:n})}}),onPress:r}):React.createElement(ie,{label:t,leading:React.createElement(ie.Icon,{source:n}),onPress:r})}const se=C.findByProps("openLazy","hideActionSheet"),Je=/^```(?:json)\n([\s\S]*?)```$/gm,ue=B.getAssetIDByName("ic_download_24px");function Ge(){return G.before("openLazy",se,function(e){let[t,n]=e;n==="MessageLongPressActionSheet"&&t.then(function(r){const a=G.after("default",r,function(f,l){let[{message:g}]=f;i.React.useEffect(function(){return function(){a()}},[]);const m=g.content.match(Je)?.map(function(s){return s.slice(7,s.length-3)}).map(function(s){try{return JSON.parse(s)}catch{return}}).filter(function(s){return s}).filter(function(s){return typeof s.name=="string"&&s.name&&typeof s.match=="string"&&typeof s.replace=="string"&&typeof s.flags=="string"&&typeof s.regex=="boolean"});if(!m||m.length==0)return;const b=Le.findInReactTree(l,function(s){return s?.[0]?.type?.name==="ButtonRow"});if(b)for(const s of m){const o=function(){c.storage.rules.push(s),h.showToast(`Imported rule ${s.name}`,ue),se.hideActionSheet()},d=i.React.createElement(Oe,{icon:ue,label:`Import ${s.name}`,onPress:o});b.unshift(d)}})})})}const Ye=C.findByProps("sendMessage","receiveMessage"),He=B.getAssetIDByName("ic_warning_24px");function je(){return G.before("sendMessage",Ye,function(e){const t=c.storage.rules.filter(function(r){return r.match});let n=e[1].content;for(const r of t)if(r.regex)try{const a=new RegExp(r.match,r.flags);n=n.replace(a,r.replace)}catch(a){console.log(a),h.showToast(`Failed to use RegExp for ${r.name}!`,He);continue}else n=n.replaceAll(r.match,r.replace);e[1].content=n})}const{TouchableOpacity:qe}=R.General,{FormIcon:Ke}=R.Forms,Xe=B.getAssetIDByName("ic_add_24px");function We(e){let{onPress:t}=e;return React.createElement(qe,{onPress:t},React.createElement(Ke,{source:Xe,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:Qe}=R.General,{FormSection:N,FormInput:V,FormDivider:de,FormSwitchRow:Ze,FormRow:fe,FormLabel:et}=R.Forms,tt=B.getAssetIDByName("ic_message_copy"),nt=i.stylesheet.createThemedStyleSheet({delete:{color:$.rawColors.RED_400}});function ge(e){let{ruleIndex:t}=e,n=c.storage.rules[t];Y.useProxy(c.storage);const r=i.NavigationNative.useNavigation(),a=function(){const l=`\`\`\`json
${JSON.stringify(n,null,4)}
\`\`\``;i.clipboard.setString(l),h.showToast(`Copied ${n.name} to Clipboard`,tt)},f=function(){c.storage.rules.splice(t,1),r.pop()};return React.createElement(Qe,null,React.createElement(N,null,React.createElement(V,{value:n?.name,onChange:function(l){return n.name=l},placeholder:"New rule",title:"Name"})),React.createElement(N,null,React.createElement(V,{value:n?.match,onChange:function(l){return n.match=l},placeholder:"foo",title:"Match"}),n?.regex&&React.createElement(React.Fragment,null,React.createElement(de,null),React.createElement(V,{title:"Flags",placeholder:"gi",value:n?.flags,onChange:function(l){return n.flags=l}})),React.createElement(de,null),React.createElement(V,{value:n?.replace,onChange:function(l){return n.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(N,null,React.createElement(Ze,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:n?.regex,onValueChange:function(l){return n.regex=l}})),React.createElement(N,null,React.createElement(fe,{label:"Copy code block to Clipboard",onPress:a})),React.createElement(N,null,React.createElement(fe,{label:React.createElement(et,{text:"Delete Rule",style:nt.delete}),onPress:f})))}const{FormRow:rt,FormArrow:at}=R.Forms;function ot(e){let{rule:t,index:n}=e;const r=i.NavigationNative.useNavigation();return React.createElement(rt,{label:t.name,trailing:React.createElement(at,null),onPress:function(){return r.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(ge,{ruleIndex:n})}})}})}const lt=C.findByStoreName("UserStore"),{pushModal:ct,popModal:it}=C.findByProps("pushModal","popModal"),j=function(){return new URL(c.storage.vencordCloudSyncSettings.backendUrl)},he=function(){return j().origin},q=function(){const e=lt.getCurrentUser()?.id;if(!e)throw new Error("User not yet logged in");return e};async function ve(){const e=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{},t=he();return e[`${t}:${q()}`]}async function st(e){const t=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{};return t[`${he()}:${q()}`]=e,t}async function ut(){if(await ve()!==void 0){console.debug("authorizeCloud() | getAuthorization() returned value"),c.storage.vencordCloudSyncSettings.authenticated=!0;return}try{const r=await fetch(new URL("/v1/oauth/settings",j()));var{clientId:e,redirectUri:t}=await r.json();console.debug("authorizeCloud() | clientId: ",e," ; redirectUri: ",t)}catch(r){console.error(r),h.showToast("Cloud Integration: Setup failed (couldn't retrieve OAuth configuration)."),c.storage.vencordCloudSyncSettings.authenticated=!1;return}const n=C.findByName("OAuth2AuthorizeModal");ct({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:n,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:e,redirectUri:t,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(r){let{location:a}=r;if(!a){console.debug("authorizeCloud() -> pushModal() -> callback | location is false/invalid"),c.storage.vencordCloudSyncSettings.authenticated=!1;return}try{const f=await fetch(a,{headers:new Headers({Accept:"application/json"})}),{secret:l}=await f.json();l?(console.info("Authorized with secret"),await st(l),h.showToast("Cloud Integration: Cloud integrations enabled!"),c.storage.vencordCloudSyncSettings.authenticated=!0):(h.showToast("Cloud Integration: Setup failed (no secret returned?)."),c.storage.vencordCloudSyncSettings.authenticated=!1)}catch(f){console.error("Failed to authorize",f),h.showToast(`Cloud Integration: Setup failed (${f.toString()}).`),c.storage.vencordCloudSyncSettings.authenticated=!1}},dismissOAuthModal:function(){return it("oauth2-authorize")}},closable:!0}})}async function dt(){const e=await ve();return Buffer.from(`${e}:${q()}`).toString("base64")}var v=Uint8Array,F=Uint16Array,ft=Int32Array,ye=new v([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Se=new v([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gt=new v([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Re=function(e,t){for(var n=new F(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new ft(n[30]),r=1;r<30;++r)for(var f=n[r];f<n[r+1];++f)a[f]=f-n[r]<<5|r;return{b:n,r:a}},me=Re(ye,2),we=me.b,ht=me.r;we[28]=258,ht[258]=28;for(var vt=Re(Se,0),yt=vt.b,K=new F(32768),u=0;u<32768;++u){var E=(u&43690)>>1|(u&21845)<<1;E=(E&52428)>>2|(E&13107)<<2,E=(E&61680)>>4|(E&3855)<<4,K[u]=((E&65280)>>8|(E&255)<<8)>>1}for(var P=function(e,t,n){for(var r=e.length,a=0,f=new F(t);a<r;++a)e[a]&&++f[e[a]-1];var l=new F(t);for(a=1;a<t;++a)l[a]=l[a-1]+f[a-1]<<1;var g;if(n){g=new F(1<<t);var m=15-t;for(a=0;a<r;++a)if(e[a])for(var b=a<<4|e[a],s=t-e[a],o=l[e[a]-1]++<<s,d=o|(1<<s)-1;o<=d;++o)g[K[o]>>m]=b}else for(g=new F(r),a=0;a<r;++a)e[a]&&(g[a]=K[l[e[a]-1]++]>>15-e[a]);return g},M=new v(288),u=0;u<144;++u)M[u]=8;for(var u=144;u<256;++u)M[u]=9;for(var u=256;u<280;++u)M[u]=7;for(var u=280;u<288;++u)M[u]=8;for(var pe=new v(32),u=0;u<32;++u)pe[u]=5;var St=P(M,9,1),Rt=P(pe,5,1),X=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},W=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},mt=function(e){return(e+7)/8|0},wt=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new v(e.subarray(t,n))},pt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(e,t,n){var r=new Error(t||pt[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,p),!n)throw r;return r},Ct=function(e,t,n,r){var a=e.length,f=r?r.length:0;if(!a||t.f&&!t.l)return n||new v(0);var l=!n,g=l||t.i!=2,m=t.i;l&&(n=new v(a*3));var b=function(Be){var Ve=n.length;if(Be>Ve){var De=new v(Math.max(Ve*2,Be));De.set(n),n=De}},s=t.f||0,o=t.p||0,d=t.b||0,x=t.l,L=t.d,z=t.m,U=t.n,Z=a*8;do{if(!x){s=S(e,o,1);var ee=S(e,o+1,3);if(o+=3,ee)if(ee==1)x=St,L=Rt,z=9,U=5;else if(ee==2){var re=S(e,o,31)+257,$e=S(e,o+10,15)+4,Ne=re+S(e,o+5,31)+1;o+=14;for(var k=new v(Ne),ae=new v(19),y=0;y<$e;++y)ae[gt[y]]=S(e,o+y*3,7);o+=$e*3;for(var Pe=X(ae),Lt=(1<<Pe)-1,Ot=P(ae,Pe,1),y=0;y<Ne;){var Me=Ot[S(e,o,Lt)];o+=Me&15;var w=Me>>4;if(w<16)k[y++]=w;else{var A=0,O=0;for(w==16?(O=3+S(e,o,3),o+=2,A=k[y-1]):w==17?(O=3+S(e,o,7),o+=3):w==18&&(O=11+S(e,o,127),o+=7);O--;)k[y++]=A}}var ze=k.subarray(0,re),T=k.subarray(re);z=X(ze),U=X(T),x=P(ze,z,1),L=P(T,U,1)}else p(1);else{var w=mt(o)+4,te=e[w-4]|e[w-3]<<8,ne=w+te;if(ne>a){m&&p(0);break}g&&b(d+te),n.set(e.subarray(w,ne),d),t.b=d+=te,t.p=o=ne*8,t.f=s;continue}if(o>Z){m&&p(0);break}}g&&b(d+131072);for(var Jt=(1<<z)-1,Gt=(1<<U)-1,oe=o;;oe=o){var A=x[W(e,o)&Jt],I=A>>4;if(o+=A&15,o>Z){m&&p(0);break}if(A||p(2),I<256)n[d++]=I;else if(I==256){oe=o,x=null;break}else{var Ue=I-254;if(I>264){var y=I-257,_=ye[y];Ue=S(e,o,(1<<_)-1)+we[y],o+=_}var le=L[W(e,o)&Gt],ce=le>>4;le||p(3),o+=le&15;var T=yt[ce];if(ce>3){var _=Se[ce];T+=W(e,o)&(1<<_)-1,o+=_}if(o>Z){m&&p(0);break}g&&b(d+131072);var ke=d+Ue;if(d<T){var _e=f-T,Yt=Math.min(T,ke);for(_e+d<0&&p(3);d<Yt;++d)n[d]=r[_e+d]}for(;d<ke;++d)n[d]=n[d-T]}}t.l=x,t.p=oe,t.b=d,t.f=s,x&&(s=1,t.m=z,t.d=L,t.n=U)}while(!s);return d!=n.length&&l?wt(n,0,d):n.subarray(0,d)},Et=new v(0);function bt(e,t){return Ct(e,{i:2},t&&t.out,t&&t.dictionary)}var Tt=typeof TextDecoder<"u"&&new TextDecoder,xt=0;try{Tt.decode(Et,{stream:!0}),xt=1}catch{}function D(e,t){return e.length>t?e.slice(0,t)+"...":e}function Ft(e){const t="TextReplace_rulesString",n="TextReplace_rulesRegex";let r=[];return console.debug("vencordRules:"+JSON.stringify(e)),e[t].forEach(function(a){a.find!==""&&a.replace!==""&&r.push({name:D(a.find,20)+" \u2192 "+D(a.replace,20),match:a.find,flags:"",replace:a.replace,regex:!1})}),e[n].forEach(function(a){const f=/^(.*)\/([a-z]+)$/,l=a.find.match(f);let g="";l&&(g=l[2]),a.find!==""&&a.replace!==""&&r.push({name:D(a.find,20)+" \u2192 "+D(a.replace,20),match:a.find,flags:g,replace:a.replace,regex:!0})}),console.debug("vendettaRules:"+JSON.stringify(r)),r}function At(e){try{var t=JSON.parse(e)}catch(r){throw console.log(e),new Error("Failed to parse JSON: "+String(r))}let n;if("settings"in t&&"quickCss"in t)if("plugins"in t.settings&&"TextReplace"in t.settings.plugins)if("rules"in t.settings.plugins.TextReplace)n=t.settings.plugins.TextReplace.rules,c.storage.rules=Ft(n);else throw new Error("There are no TextReplace rules stored in the Vencord Cloud Settings of this user account.");else throw new Error("TextReplace could not be found in the Vencord Cloud Settings.");else throw new Error("Invalid Settings. Is this even a Vencord Settings file?")}async function It(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{console.debug("Start getting cloud settings...");const n=await fetch(new URL("/v1/settings",j()),{method:"GET",headers:new Headers({Authorization:await dt(),Accept:"application/octet-stream","If-None-Match":t?"":c.storage.vencordCloudSyncSettings.syncVersion.toString()})});if(console.debug("vencordCloud/v1/settings response: ",n),n.status===404)return console.info("No settings on the cloud"),e&&h.showToast("Cloud Settings: There are no settings in the cloud."),!1;if(n.status===304)return console.info("Settings up to date"),e&&h.showToast("Cloud Settings: Your settings are up to date."),!1;if(!n.ok)return console.error(`Failed to sync down, API returned ${n.status}`),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (API returned ${n.status}).`),!1;const r=Number(n.headers.get("etag")),a=c.storage.vencordCloudSyncSettings.syncVersion;if(!t&&r<a){e&&h.showToast("Cloud Settings: Your local settings are newer than the cloud ones.");return}const f=await n.arrayBuffer(),l=new TextDecoder().decode(bt(new Uint8Array(f)));return At(l),c.storage.vencordCloudSyncSettings.syncVersion=r,console.info("Settings loaded from cloud successfully"),e&&h.showToast("Cloud Settings: Your settings have been updated!"),!0}catch(n){return console.error("Failed to sync down",n),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (${n.toString()}).`),!1}}const{ScrollView:$t}=R.General,{FormSection:Q,FormInput:Nt,FormDivider:Ce,FormSwitchRow:Pt,FormRow:Ee}=R.Forms,be=i.stylesheet.createThemedStyleSheet({dangerButton:{backgroundColor:$.rawColors.RED_400,marginHorizontal:16},inputLabel:{marginTop:-40}});function Mt(){return{authenticated:!1,backendUrl:"https://api.vencord.dev/",syncVersion:0,vencordCloudSecret:{}}}function zt(){return c.storage.vencordCloudSyncSettings===void 0&&(c.storage.vencordCloudSyncSettings=Mt()),Y.useProxy(c.storage),React.createElement($t,null,React.createElement(Q,null,React.createElement(Pt,{label:"Enable Cloud Integrations",value:c.storage.vencordCloudSyncSettings.authenticated,onValueChange:function(e){e?ut():c.storage.vencordCloudSyncSettings.authenticated=e},subLabel:"This will request authorization if you have not yet set up cloud integrations."})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Nt,{value:c.storage.vencordCloudSyncSettings.backendUrl,onChange:function(e){return c.storage.vencordCloudSyncSettings.backendUrl=e},title:"Backend URL"}),React.createElement(Ee,{subLabel:"Which backend to use when using cloud integrations.",style:be.inputLabel})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Ee,{label:"This will overwrite your local settings with the ones on the cloud. Use wisely!"}),React.createElement(R.Button,{style:be.dangerButton,text:"Sync from Cloud",disabled:!c.storage.vencordCloudSyncSettings.authenticated,onPress:function(){console.debug("'Sync from Cloud' pressed"),It(!0,!0)}},"Sync from Cloud")))}const{ScrollView:Ut,TextInput:kt}=R.General,{FormRow:Te,FormSection:xe,FormDivider:Fe,FormArrow:_t}=R.Forms,Ae=i.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:i.constants.Fonts.PRIMARY_MEDIUM,color:$.semanticColors.TEXT_NORMAL},placeholder:{color:$.semanticColors.INPUT_PLACEHOLDER_TEXT}}),Bt=C.findByName("useIsFocused");function Vt(){const[e,t]=i.React.useState("");let n=c.storage.rules;Y.useProxy(c.storage);const r=i.NavigationNative.useNavigation();Bt();const a=function(){e&&(n.push({name:e.trim(),match:"",flags:"gi",replace:"",regex:!1}),t(""),r.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return i.React.createElement(ge,{ruleIndex:n.length-1})}}))},f=function(){r.push("VendettaCustomPage",{title:"Vencord TextReplace Cloud Sync",render:function(){return i.React.createElement(zt,null)}})};return i.React.createElement(Ut,null,i.React.createElement(xe,{title:"Import/export rules"},i.React.createElement(Te,{label:"Vencord TextReplace Cloud Sync Settings",onPress:f,trailing:i.React.createElement(_t,null)}),i.React.createElement(Fe,null)),i.React.createElement(xe,{title:"Rules"},n.map(function(l,g){return i.React.createElement(i.React.Fragment,null,i.React.createElement(ot,{rule:l,index:g}),i.React.createElement(Fe,null))}),i.React.createElement(Te,{label:i.React.createElement(kt,{value:e,onChangeText:t,placeholder:"New rule",placeholderTextColor:Ae.placeholder.color,selectionColor:i.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:a,returnKeyType:"done",style:Ae.input}),trailing:i.React.createElement(We,{onPress:a})})))}let Ie;var Dt={onLoad:function(){var e;(e=c.storage).rules??(e.rules=[]),Ie=[je(),Ge()]},onUnload:function(){for(const e of Ie)e()},settings:Vt};return J.default=Dt,Object.defineProperty(J,"__esModule",{value:!0}),J})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils,vendetta.ui,vendetta.storage,vendetta.ui.components);
