(function(G,i,b,c,Y,B,g,Le,I,j,S){"use strict";const{ActionSheetRow:H}=b.findByProps("ActionSheetRow"),{FormRow:ce}=b.findByProps("FormRow");function Oe(e){let{label:t,icon:n,onPress:a}=e;const r=c.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:I.semanticColors.INTERACTIVE_NORMAL}});return H?React.createElement(H,{label:t,icon:React.createElement(H.Icon,{source:n,IconComponent:function(){return React.createElement(c.ReactNative.Image,{resizeMode:"cover",style:r.iconComponent,source:n})}}),onPress:a}):React.createElement(ce,{label:t,leading:React.createElement(ce.Icon,{source:n}),onPress:a})}const se=b.findByProps("openLazy","hideActionSheet"),Ge=/^```(?:json)\n([\s\S]*?)```$/gm,ue=B.getAssetIDByName("ic_download_24px");function Ye(){return Y.before("openLazy",se,function(e){let[t,n]=e;n==="MessageLongPressActionSheet"&&t.then(function(a){const r=Y.after("default",a,function(d,l){let[{message:f}]=d;var h;c.React.useEffect(function(){return function(){r()}},[]);const E=(h=f.content.match(Ge))===null||h===void 0?void 0:h.map(function(o){return o.slice(7,o.length-3)}).map(function(o){try{return JSON.parse(o)}catch{return}}).filter(function(o){return o}).filter(function(o){return typeof o.name=="string"&&o.name&&typeof o.match=="string"&&typeof o.replace=="string"&&typeof o.flags=="string"&&typeof o.regex=="boolean"});if(!E||E.length==0)return;const m=Le.findInReactTree(l,function(o){var s,v;return(o==null||(v=o[0])===null||v===void 0||(s=v.type)===null||s===void 0?void 0:s.name)==="ButtonRow"});if(m)for(const o of E){const s=function(){i.storage.rules.push(o),g.showToast(`Imported rule ${o.name}`,ue),se.hideActionSheet()},v=c.React.createElement(Oe,{icon:ue,label:`Import ${o.name}`,onPress:s});m.unshift(v)}})})})}const je=b.findByProps("sendMessage","receiveMessage"),He=B.getAssetIDByName("ic_warning_24px");function Je(){return Y.before("sendMessage",je,function(e){const t=i.storage.rules.filter(function(a){return a.match});let n=e[1].content;for(const a of t)if(a.regex)try{const r=new RegExp(a.match,a.flags);n=n.replace(r,a.replace)}catch(r){console.log(r),g.showToast(`Failed to use RegExp for ${a.name}!`,He);continue}else n=n.replaceAll(a.match,a.replace);e[1].content=n})}const{TouchableOpacity:qe}=S.General,{FormIcon:Ke}=S.Forms,Xe=B.getAssetIDByName("ic_add_24px");function We(e){let{onPress:t}=e;return React.createElement(qe,{onPress:t},React.createElement(Ke,{source:Xe,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:Qe}=S.General,{FormSection:N,FormInput:V,FormDivider:de,FormSwitchRow:Ze,FormRow:fe,FormLabel:et}=S.Forms,tt=B.getAssetIDByName("ic_message_copy"),nt=c.stylesheet.createThemedStyleSheet({delete:{color:I.rawColors.RED_400}});function ge(e){let{ruleIndex:t}=e,n=i.storage.rules[t];j.useProxy(i.storage);const a=c.NavigationNative.useNavigation(),r=function(){const l=`\`\`\`json
${JSON.stringify(n,null,4)}
\`\`\``;c.clipboard.setString(l),g.showToast(`Copied ${n.name} to Clipboard`,tt)},d=function(){i.storage.rules.splice(t,1),a.pop()};return React.createElement(Qe,null,React.createElement(N,null,React.createElement(V,{value:n?.name,onChange:function(l){return n.name=l},placeholder:"New rule",title:"Name"})),React.createElement(N,null,React.createElement(V,{value:n?.match,onChange:function(l){return n.match=l},placeholder:"foo",title:"Match"}),n?.regex&&React.createElement(React.Fragment,null,React.createElement(de,null),React.createElement(V,{title:"Flags",placeholder:"gi",value:n?.flags,onChange:function(l){return n.flags=l}})),React.createElement(de,null),React.createElement(V,{value:n?.replace,onChange:function(l){return n.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(N,null,React.createElement(Ze,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:n?.regex,onValueChange:function(l){return n.regex=l}})),React.createElement(N,null,React.createElement(fe,{label:"Copy code block to Clipboard",onPress:r})),React.createElement(N,null,React.createElement(fe,{label:React.createElement(et,{text:"Delete Rule",style:nt.delete}),onPress:d})))}const{FormRow:rt,FormArrow:at}=S.Forms;function ot(e){let{rule:t,index:n}=e;const a=c.NavigationNative.useNavigation();return React.createElement(rt,{label:t.name,trailing:React.createElement(at,null),onPress:function(){return a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(ge,{ruleIndex:n})}})}})}const lt=b.findByStoreName("UserStore"),{pushModal:it,popModal:ct}=b.findByProps("pushModal","popModal"),J=function(){return new URL(i.storage.vencordCloudSyncSettings.backendUrl)},he=function(){return J().origin},q=function(){var e;const t=(e=lt.getCurrentUser())===null||e===void 0?void 0:e.id;if(!t)throw new Error("User not yet logged in");return t};async function ve(){const e=i.storage.vencordCloudSyncSettings.vencordCloudSecret??{},t=he();return e[`${t}:${q()}`]}async function st(e){const t=i.storage.vencordCloudSyncSettings.vencordCloudSecret??{};return t[`${he()}:${q()}`]=e,t}async function ut(){if(await ve()!==void 0){i.storage.vencordCloudSyncSettings.authenticated=!0;return}try{const a=await fetch(new URL("/v1/oauth/settings",J()));var{clientId:e,redirectUri:t}=await a.json()}catch(a){console.error(a),g.showToast("Cloud Integration: Setup failed (couldn't retrieve OAuth configuration)."),i.storage.vencordCloudSyncSettings.authenticated=!1;return}const n=b.findByName("OAuth2AuthorizeModal");it({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:n,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:e,redirectUri:t,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(a){let{location:r}=a;if(!r){i.storage.vencordCloudSyncSettings.authenticated=!1;return}try{const d=await fetch(r,{headers:new Headers({Accept:"application/json"})}),{secret:l}=await d.json();l?(console.info("Authorized with secret"),await st(l),g.showToast("Cloud Integration: Cloud integrations enabled!"),i.storage.vencordCloudSyncSettings.authenticated=!0):(g.showToast("Cloud Integration: Setup failed (no secret returned?)."),i.storage.vencordCloudSyncSettings.authenticated=!1)}catch(d){console.error("Failed to authorize",d),g.showToast(`Cloud Integration: Setup failed (${d.toString()}).`),i.storage.vencordCloudSyncSettings.authenticated=!1}},dismissOAuthModal:function(){return ct("oauth2-authorize")}},closable:!0}})}async function dt(){const e=await ve();return Buffer.from(`${e}:${q()}`).toString("base64")}var y=Uint8Array,F=Uint16Array,ft=Int32Array,ye=new y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Re=new y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gt=new y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),we=function(e,t){for(var n=new F(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];for(var r=new ft(n[30]),a=1;a<30;++a)for(var d=n[a];d<n[a+1];++d)r[d]=d-n[a]<<5|a;return{b:n,r}},me=we(ye,2),Se=me.b,ht=me.r;Se[28]=258,ht[258]=28;for(var vt=we(Re,0),yt=vt.b,K=new F(32768),u=0;u<32768;++u){var T=(u&43690)>>1|(u&21845)<<1;T=(T&52428)>>2|(T&13107)<<2,T=(T&61680)>>4|(T&3855)<<4,K[u]=((T&65280)>>8|(T&255)<<8)>>1}for(var P=function(e,t,n){for(var a=e.length,r=0,d=new F(t);r<a;++r)e[r]&&++d[e[r]-1];var l=new F(t);for(r=1;r<t;++r)l[r]=l[r-1]+d[r-1]<<1;var f;if(n){f=new F(1<<t);var h=15-t;for(r=0;r<a;++r)if(e[r])for(var E=r<<4|e[r],m=t-e[r],o=l[e[r]-1]++<<m,s=o|(1<<m)-1;o<=s;++o)f[K[o]>>h]=E}else for(f=new F(a),r=0;r<a;++r)e[r]&&(f[r]=K[l[e[r]-1]++]>>15-e[r]);return f},M=new y(288),u=0;u<144;++u)M[u]=8;for(var u=144;u<256;++u)M[u]=9;for(var u=256;u<280;++u)M[u]=7;for(var u=280;u<288;++u)M[u]=8;for(var pe=new y(32),u=0;u<32;++u)pe[u]=5;var Rt=P(M,9,1),wt=P(pe,5,1),X=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},w=function(e,t,n){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(t&7)&n},W=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},mt=function(e){return(e+7)/8|0},St=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new y(e.subarray(t,n))},pt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(e,t,n){var a=new Error(t||pt[e]);if(a.code=e,Error.captureStackTrace&&Error.captureStackTrace(a,C),!n)throw a;return a},Ct=function(e,t,n,a){var r=e.length,d=a?a.length:0;if(!r||t.f&&!t.l)return n||new y(0);var l=!n,f=l||t.i!=2,h=t.i;l&&(n=new y(r*3));var E=function(Be){var Ve=n.length;if(Be>Ve){var De=new y(Math.max(Ve*2,Be));De.set(n),n=De}},m=t.f||0,o=t.p||0,s=t.b||0,v=t.l,L=t.d,k=t.m,U=t.n,Z=r*8;do{if(!v){m=w(e,o,1);var ee=w(e,o+1,3);if(o+=3,ee)if(ee==1)v=Rt,L=wt,k=9,U=5;else if(ee==2){var re=w(e,o,31)+257,Ie=w(e,o+10,15)+4,Ne=re+w(e,o+5,31)+1;o+=14;for(var _=new y(Ne),ae=new y(19),R=0;R<Ie;++R)ae[gt[R]]=w(e,o+R*3,7);o+=Ie*3;for(var Pe=X(ae),Lt=(1<<Pe)-1,Ot=P(ae,Pe,1),R=0;R<Ne;){var Me=Ot[w(e,o,Lt)];o+=Me&15;var p=Me>>4;if(p<16)_[R++]=p;else{var $=0,O=0;for(p==16?(O=3+w(e,o,3),o+=2,$=_[R-1]):p==17?(O=3+w(e,o,7),o+=3):p==18&&(O=11+w(e,o,127),o+=7);O--;)_[R++]=$}}var ke=_.subarray(0,re),x=_.subarray(re);k=X(ke),U=X(x),v=P(ke,k,1),L=P(x,U,1)}else C(1);else{var p=mt(o)+4,te=e[p-4]|e[p-3]<<8,ne=p+te;if(ne>r){h&&C(0);break}f&&E(s+te),n.set(e.subarray(p,ne),s),t.b=s+=te,t.p=o=ne*8,t.f=m;continue}if(o>Z){h&&C(0);break}}f&&E(s+131072);for(var Gt=(1<<k)-1,Yt=(1<<U)-1,oe=o;;oe=o){var $=v[W(e,o)&Gt],A=$>>4;if(o+=$&15,o>Z){h&&C(0);break}if($||C(2),A<256)n[s++]=A;else if(A==256){oe=o,v=null;break}else{var Ue=A-254;if(A>264){var R=A-257,z=ye[R];Ue=w(e,o,(1<<z)-1)+Se[R],o+=z}var le=L[W(e,o)&Yt],ie=le>>4;le||C(3),o+=le&15;var x=yt[ie];if(ie>3){var z=Re[ie];x+=W(e,o)&(1<<z)-1,o+=z}if(o>Z){h&&C(0);break}f&&E(s+131072);var _e=s+Ue;if(s<x){var ze=d-x,jt=Math.min(x,_e);for(ze+s<0&&C(3);s<jt;++s)n[s]=a[ze+s]}for(;s<_e;++s)n[s]=n[s-x]}}t.l=v,t.p=oe,t.b=s,t.f=m,v&&(m=1,t.m=k,t.d=L,t.n=U)}while(!m);return s!=n.length&&l?St(n,0,s):n.subarray(0,s)},Et=new y(0);function bt(e,t){return Ct(e,{i:2},t&&t.out,t&&t.dictionary)}var Tt=typeof TextDecoder<"u"&&new TextDecoder,xt=0;try{Tt.decode(Et,{stream:!0}),xt=1}catch{}function D(e,t){return e.length>t?e.slice(0,t)+"...":e}function Ft(e){const t="TextReplace_rulesString",n="TextReplace_rulesRegex";let a=[];if(!e[t]||!e[n])throw new Error("Missing required rule keys in Vencord rules.");return e[t].forEach(function(r){r.find!==""&&r.replace!==""&&a.push({name:D(r.find,20)+" \u2192 "+D(r.replace,20),match:r.find,flags:"",replace:r.replace,regex:!1})}),e[n].forEach(function(r){const d=/(\/([a-z]+)(?<!\\\/[a-z]+))$/,l=r.find.match(d);let f="",h=r.find;l&&(f=l[1],h=r.find.split(f)[0],f=f.split("/")[1]),f.includes("g")||(f+="g"),f=f.split("").sort().join(""),r.find!==""&&r.replace!==""&&a.push({name:D(r.find,20)+" \u2192 "+D(r.replace,20),match:h,flags:f,replace:r.replace,regex:!0})}),a}function $t(e){try{var t=JSON.parse(e)}catch(a){throw console.log(e),new Error("Failed to parse JSON: "+String(a))}let n;if("settings"in t&&"quickCss"in t)if("plugins"in t.settings&&"TextReplace"in t.settings.plugins||"TextReplace2"in t.settings.plugins)if("rules"in t.settings.plugins.TextReplace||"rules"in t.settings.plugins.TextReplace2)n=t.settings.plugins.TextReplace.rules??t.settings.plugins.TextReplace2.rules,i.storage.rules=Ft(n);else throw new Error("There are no TextReplace rules stored in the Vencord Cloud Settings of this user account.");else throw new Error("TextReplace could not be found in the Vencord Cloud Settings.");else throw new Error("Invalid Settings. Is this even a Vencord Settings file?")}async function At(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{const n=await fetch(new URL("/v1/settings",J()),{method:"GET",headers:new Headers({Authorization:await dt(),Accept:"application/octet-stream","If-None-Match":t?"":i.storage.vencordCloudSyncSettings.syncVersion.toString()})});if(n.status===404)return console.info("No settings on the cloud"),e&&g.showToast("Cloud Settings: There are no settings in the cloud."),!1;if(n.status===304)return console.info("Settings up to date"),e&&g.showToast("Cloud Settings: Your settings are up to date."),!1;if(!n.ok)return console.error(`Failed to sync down, API returned ${n.status}`),g.showToast(`Cloud Settings: Could not synchronize settings from the cloud (API returned ${n.status}).`),!1;const a=Number(n.headers.get("etag")),r=i.storage.vencordCloudSyncSettings.syncVersion;if(!t&&a<r){e&&g.showToast("Cloud Settings: Your local settings are newer than the cloud ones.");return}const d=await n.arrayBuffer(),l=new TextDecoder().decode(bt(new Uint8Array(d)));return $t(l),i.storage.vencordCloudSyncSettings.syncVersion=a,console.info("Settings loaded from cloud successfully"),e&&g.showToast("Cloud Settings: Your settings have been updated!"),!0}catch(n){return console.error("Failed to sync down",n),g.showToast(`Cloud Settings: Could not synchronize settings from the cloud (${n.toString()}).`),!1}}const{ScrollView:It}=S.General,{FormSection:Q,FormInput:Nt,FormDivider:Ce,FormSwitchRow:Pt,FormRow:Ee}=S.Forms,be=c.stylesheet.createThemedStyleSheet({dangerButton:{backgroundColor:I.rawColors.RED_400,marginHorizontal:16},inputLabel:{marginTop:-40}});function Mt(){return{authenticated:!1,backendUrl:"https://api.vencord.dev/",syncVersion:0,vencordCloudSecret:{}}}function kt(){return i.storage.vencordCloudSyncSettings===void 0&&(i.storage.vencordCloudSyncSettings=Mt()),j.useProxy(i.storage),React.createElement(It,null,React.createElement(Q,null,React.createElement(Pt,{label:"Enable Cloud Integrations",value:i.storage.vencordCloudSyncSettings.authenticated,onValueChange:function(e){e?ut():i.storage.vencordCloudSyncSettings.authenticated=e},subLabel:"This will request authorization if you have not yet set up cloud integrations."})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Nt,{value:i.storage.vencordCloudSyncSettings.backendUrl,onChange:function(e){return i.storage.vencordCloudSyncSettings.backendUrl=e},title:"Backend URL"}),React.createElement(Ee,{subLabel:"Which backend to use when using cloud integrations.",style:be.inputLabel})),React.createElement(Q,null,React.createElement(Ce,null),React.createElement(Ee,{label:"This will overwrite your local settings with the ones on the cloud. Use wisely!"}),React.createElement(S.Button,{style:be.dangerButton,text:"Sync from Cloud",disabled:!i.storage.vencordCloudSyncSettings.authenticated,onPress:function(){At(!0,!0)}},"Sync from Cloud")))}const{ScrollView:Ut,TextInput:_t}=S.General,{FormRow:Te,FormSection:xe,FormDivider:Fe,FormArrow:zt}=S.Forms,$e=c.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:c.constants.Fonts.PRIMARY_MEDIUM,color:I.semanticColors.TEXT_NORMAL},placeholder:{color:I.semanticColors.INPUT_PLACEHOLDER_TEXT}}),Bt=b.findByName("useIsFocused");function Vt(){const[e,t]=c.React.useState("");let n=i.storage.rules;j.useProxy(i.storage);const a=c.NavigationNative.useNavigation();Bt();const r=function(){e&&(n.push({name:e.trim(),match:"",flags:"gi",replace:"",regex:!1}),t(""),a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return c.React.createElement(ge,{ruleIndex:n.length-1})}}))},d=function(){a.push("VendettaCustomPage",{title:"Vencord TextReplace Cloud Sync",render:function(){return c.React.createElement(kt,null)}})};return c.React.createElement(Ut,null,c.React.createElement(xe,{title:"Import/export rules"},c.React.createElement(Te,{label:"Vencord TextReplace Cloud Sync Settings",onPress:d,trailing:c.React.createElement(zt,null)}),c.React.createElement(Fe,null)),c.React.createElement(xe,{title:"Rules"},n.map(function(l,f){return c.React.createElement(c.React.Fragment,null,c.React.createElement(ot,{rule:l,index:f}),c.React.createElement(Fe,null))}),c.React.createElement(Te,{label:c.React.createElement(_t,{value:e,onChangeText:t,placeholder:"New rule",placeholderTextColor:$e.placeholder.color,selectionColor:c.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:r,returnKeyType:"done",style:$e.input}),trailing:c.React.createElement(We,{onPress:r})})))}let Ae;var Dt={onLoad:function(){var e;(e=i.storage).rules??(e.rules=[]),Ae=[Je(),Ye()]},onUnload:function(){for(const e of Ae)e()},settings:Vt};return G.default=Dt,Object.defineProperty(G,"__esModule",{value:!0}),G})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils,vendetta.ui,vendetta.storage,vendetta.ui.components);
