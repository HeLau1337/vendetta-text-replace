(function(J,c,T,i,G,_,m,h,Y,V){"use strict";const ce=T.findByProps("openLazy","hideActionSheet"),{FormRow:_e,FormIcon:Ve}=m.Forms,De=/^```(?:json)\n([\s\S]*?)```$/gm,ie=_.getAssetIDByName("ic_download_24px");function Be(){return G.before("openLazy",ce,function(e){let[t,r]=e;r==="MessageLongPressActionSheet"&&t.then(function(a){const n=G.after("default",a,function(f,l){let[{message:g}]=f;i.React.useEffect(function(){return function(){n()}},[]);const p=g.content.match(De)?.map(function(s){return s.slice(7,s.length-3)}).map(function(s){try{return JSON.parse(s)}catch{return}}).filter(function(s){return s}).filter(function(s){return typeof s.name=="string"&&s.name&&typeof s.match=="string"&&typeof s.replace=="string"&&typeof s.flags=="string"&&typeof s.regex=="boolean"});if(!p||p.length==0)return;let b=l?.props?.children?.props?.children?.props?.children[1];for(const s of p){const o=function(){c.storage.rules.push(s),h.showToast(`Imported rule ${s.name}`,ie),ce.hideActionSheet()},d=i.React.createElement(_e,{leading:i.React.createElement(Ve,{style:{opacity:1},source:ie}),label:`Import ${s.name}`,onPress:o});b.unshift(d)}})})})}const Oe=T.findByProps("sendMessage","receiveMessage"),Le=_.getAssetIDByName("ic_warning_24px");function Je(){return G.before("sendMessage",Oe,function(e){const t=c.storage.rules.filter(function(a){return a.match});let r=e[1].content;for(const a of t)if(a.regex)try{const n=new RegExp(a.match,a.flags);r=r.replace(n,a.replace)}catch(n){console.log(n),h.showToast(`Failed to use RegExp for ${a.name}!`,Le);continue}else r=r.replaceAll(a.match,a.replace);e[1].content=r})}const{TouchableOpacity:Ge}=m.General,{FormIcon:Ye}=m.Forms,je=_.getAssetIDByName("ic_add_24px");function He(e){let{onPress:t}=e;return React.createElement(Ge,{onPress:t},React.createElement(Ye,{source:je,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:qe}=m.General,{FormSection:I,FormInput:D,FormDivider:se,FormSwitchRow:Ke,FormRow:ue,FormLabel:Xe}=m.Forms,Qe=_.getAssetIDByName("ic_message_copy"),We=i.stylesheet.createThemedStyleSheet({delete:{color:V.rawColors.RED_400}});function de(e){let{ruleIndex:t}=e,r=c.storage.rules[t];Y.useProxy(c.storage);const a=i.NavigationNative.useNavigation(),n=function(){const l=`\`\`\`json
${JSON.stringify(r,null,4)}
\`\`\``;i.clipboard.setString(l),h.showToast(`Copied ${r.name} to Clipboard`,Qe)},f=function(){c.storage.rules.splice(t,1),a.pop()};return React.createElement(qe,null,React.createElement(I,null,React.createElement(D,{value:r?.name,onChange:function(l){return r.name=l},placeholder:"New rule",title:"Name"})),React.createElement(I,null,React.createElement(D,{value:r?.match,onChange:function(l){return r.match=l},placeholder:"foo",title:"Match"}),r?.regex&&React.createElement(React.Fragment,null,React.createElement(se,null),React.createElement(D,{title:"Flags",placeholder:"gi",value:r?.flags,onChange:function(l){return r.flags=l}})),React.createElement(se,null),React.createElement(D,{value:r?.replace,onChange:function(l){return r.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(I,null,React.createElement(Ke,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:r?.regex,onValueChange:function(l){return r.regex=l}})),React.createElement(I,null,React.createElement(ue,{label:"Copy code block to Clipboard",onPress:n})),React.createElement(I,null,React.createElement(ue,{label:React.createElement(Xe,{text:"Delete Rule",style:We.delete}),onPress:f})))}const{FormRow:Ze,FormArrow:et}=m.Forms;function tt(e){let{rule:t,index:r}=e;const a=i.NavigationNative.useNavigation();return React.createElement(Ze,{label:t.name,trailing:React.createElement(et,null),onPress:function(){return a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(de,{ruleIndex:r})}})}})}const rt=T.findByStoreName("UserStore"),{pushModal:nt,popModal:at}=T.findByProps("pushModal","popModal"),j=function(){return new URL(c.storage.vencordCloudSyncSettings.backendUrl)},fe=function(){return j().origin},H=function(){const e=rt.getCurrentUser()?.id;if(!e)throw new Error("User not yet logged in");return e};async function ge(){const e=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{},t=fe();return e[`${t}:${H()}`]}async function ot(e){const t=c.storage.vencordCloudSyncSettings.vencordCloudSecret??{};return t[`${fe()}:${H()}`]=e,t}async function lt(){if(await ge()!==void 0){console.debug("authorizeCloud() | getAuthorization() returned value"),c.storage.vencordCloudSyncSettings.authenticated=!0;return}try{const a=await fetch(new URL("/v1/oauth/settings",j()));var{clientId:e,redirectUri:t}=await a.json();console.debug("authorizeCloud() | clientId: ",e," ; redirectUri: ",t)}catch(a){console.error(a),h.showToast("Cloud Integration: Setup failed (couldn't retrieve OAuth configuration)."),c.storage.vencordCloudSyncSettings.authenticated=!1;return}const r=T.findByName("OAuth2AuthorizeModal");nt({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:r,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:e,redirectUri:t,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(a){let{location:n}=a;if(!n){console.debug("authorizeCloud() -> pushModal() -> callback | location is false/invalid"),c.storage.vencordCloudSyncSettings.authenticated=!1;return}try{const f=await fetch(n,{headers:new Headers({Accept:"application/json"})}),{secret:l}=await f.json();l?(console.info("Authorized with secret"),await ot(l),h.showToast("Cloud Integration: Cloud integrations enabled!"),c.storage.vencordCloudSyncSettings.authenticated=!0):(h.showToast("Cloud Integration: Setup failed (no secret returned?)."),c.storage.vencordCloudSyncSettings.authenticated=!1)}catch(f){console.error("Failed to authorize",f),h.showToast(`Cloud Integration: Setup failed (${f.toString()}).`),c.storage.vencordCloudSyncSettings.authenticated=!1}},dismissOAuthModal:function(){return at("oauth2-authorize")}},closable:!0}})}async function ct(){const e=await ge();return Buffer.from(`${e}:${H()}`).toString("base64")}var v=Uint8Array,x=Uint16Array,it=Int32Array,he=new v([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ve=new v([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),st=new v([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Se=function(e,t){for(var r=new x(31),a=0;a<31;++a)r[a]=t+=1<<e[a-1];for(var n=new it(r[30]),a=1;a<30;++a)for(var f=r[a];f<r[a+1];++f)n[f]=f-r[a]<<5|a;return{b:r,r:n}},ye=Se(he,2),me=ye.b,ut=ye.r;me[28]=258,ut[258]=28;for(var dt=Se(ve,0),ft=dt.b,q=new x(32768),u=0;u<32768;++u){var C=(u&43690)>>1|(u&21845)<<1;C=(C&52428)>>2|(C&13107)<<2,C=(C&61680)>>4|(C&3855)<<4,q[u]=((C&65280)>>8|(C&255)<<8)>>1}for(var N=function(e,t,r){for(var a=e.length,n=0,f=new x(t);n<a;++n)e[n]&&++f[e[n]-1];var l=new x(t);for(n=1;n<t;++n)l[n]=l[n-1]+f[n-1]<<1;var g;if(r){g=new x(1<<t);var p=15-t;for(n=0;n<a;++n)if(e[n])for(var b=n<<4|e[n],s=t-e[n],o=l[e[n]-1]++<<s,d=o|(1<<s)-1;o<=d;++o)g[q[o]>>p]=b}else for(g=new x(a),n=0;n<a;++n)e[n]&&(g[n]=q[l[e[n]-1]++]>>15-e[n]);return g},P=new v(288),u=0;u<144;++u)P[u]=8;for(var u=144;u<256;++u)P[u]=9;for(var u=256;u<280;++u)P[u]=7;for(var u=280;u<288;++u)P[u]=8;for(var pe=new v(32),u=0;u<32;++u)pe[u]=5;var gt=N(P,9,1),ht=N(pe,5,1),K=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},y=function(e,t,r){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(t&7)&r},X=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},vt=function(e){return(e+7)/8|0},St=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new v(e.subarray(t,r))},yt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(e,t,r){var a=new Error(t||yt[e]);if(a.code=e,Error.captureStackTrace&&Error.captureStackTrace(a,R),!r)throw a;return a},mt=function(e,t,r,a){var n=e.length,f=a?a.length:0;if(!n||t.f&&!t.l)return r||new v(0);var l=!r,g=l||t.i!=2,p=t.i;l&&(r=new v(n*3));var b=function(Me){var ze=r.length;if(Me>ze){var ke=new v(Math.max(ze*2,Me));ke.set(r),r=ke}},s=t.f||0,o=t.p||0,d=t.b||0,F=t.l,O=t.d,U=t.m,M=t.n,W=n*8;do{if(!F){s=y(e,o,1);var Z=y(e,o+1,3);if(o+=3,Z)if(Z==1)F=gt,O=ht,U=9,M=5;else if(Z==2){var re=y(e,o,31)+257,Te=y(e,o+10,15)+4,xe=re+y(e,o+5,31)+1;o+=14;for(var z=new v(xe),ne=new v(19),S=0;S<Te;++S)ne[st[S]]=y(e,o+S*3,7);o+=Te*3;for(var $e=K(ne),Vt=(1<<$e)-1,Dt=N(ne,$e,1),S=0;S<xe;){var Ae=Dt[y(e,o,Vt)];o+=Ae&15;var w=Ae>>4;if(w<16)z[S++]=w;else{var $=0,L=0;for(w==16?(L=3+y(e,o,3),o+=2,$=z[S-1]):w==17?(L=3+y(e,o,7),o+=3):w==18&&(L=11+y(e,o,127),o+=7);L--;)z[S++]=$}}var Ie=z.subarray(0,re),E=z.subarray(re);U=K(Ie),M=K(E),F=N(Ie,U,1),O=N(E,M,1)}else R(1);else{var w=vt(o)+4,ee=e[w-4]|e[w-3]<<8,te=w+ee;if(te>n){p&&R(0);break}g&&b(d+ee),r.set(e.subarray(w,te),d),t.b=d+=ee,t.p=o=te*8,t.f=s;continue}if(o>W){p&&R(0);break}}g&&b(d+131072);for(var Bt=(1<<U)-1,Ot=(1<<M)-1,ae=o;;ae=o){var $=F[X(e,o)&Bt],A=$>>4;if(o+=$&15,o>W){p&&R(0);break}if($||R(2),A<256)r[d++]=A;else if(A==256){ae=o,F=null;break}else{var Ne=A-254;if(A>264){var S=A-257,k=he[S];Ne=y(e,o,(1<<k)-1)+me[S],o+=k}var oe=O[X(e,o)&Ot],le=oe>>4;oe||R(3),o+=oe&15;var E=ft[le];if(le>3){var k=ve[le];E+=X(e,o)&(1<<k)-1,o+=k}if(o>W){p&&R(0);break}g&&b(d+131072);var Pe=d+Ne;if(d<E){var Ue=f-E,Lt=Math.min(E,Pe);for(Ue+d<0&&R(3);d<Lt;++d)r[d]=a[Ue+d]}for(;d<Pe;++d)r[d]=r[d-E]}}t.l=F,t.p=ae,t.b=d,t.f=s,F&&(s=1,t.m=U,t.d=O,t.n=M)}while(!s);return d!=r.length&&l?St(r,0,d):r.subarray(0,d)},pt=new v(0);function wt(e,t){return mt(e,{i:2},t&&t.out,t&&t.dictionary)}var Rt=typeof TextDecoder<"u"&&new TextDecoder,Ct=0;try{Rt.decode(pt,{stream:!0}),Ct=1}catch{}function B(e,t){return e.length>t?e.slice(0,t)+"...":e}function Et(e){const t="TextReplace_rulesString",r="TextReplace_rulesRegex";let a=[];return console.debug("vencordRules:"+JSON.stringify(e)),e[t].forEach(function(n){n.find!==""&&n.replace!==""&&a.push({name:B(n.find,20)+" \u2192 "+B(n.replace,20),match:n.find,flags:"",replace:n.replace,regex:!1})}),e[r].forEach(function(n){const f=/^(.*)\/([a-z]+)$/,l=n.find.match(f);let g="";l&&(g=l[2]),n.find!==""&&n.replace!==""&&a.push({name:B(n.find,20)+" \u2192 "+B(n.replace,20),match:n.find,flags:g,replace:n.replace,regex:!0})}),console.debug("vendettaRules:"+JSON.stringify(a)),a}function bt(e){try{var t=JSON.parse(e)}catch(a){throw console.log(e),new Error("Failed to parse JSON: "+String(a))}let r;if("settings"in t&&"quickCss"in t)if("plugins"in t.settings&&"TextReplace"in t.settings.plugins)if("rules"in t.settings.plugins.TextReplace)r=t.settings.plugins.TextReplace.rules,c.storage.rules=Et(r);else throw new Error("There are no TextReplace rules stored in the Vencord Cloud Settings of this user account.");else throw new Error("TextReplace could not be found in the Vencord Cloud Settings.");else throw new Error("Invalid Settings. Is this even a Vencord Settings file?")}async function Ft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{console.debug("Start getting cloud settings...");const r=await fetch(new URL("/v1/settings",j()),{method:"GET",headers:new Headers({Authorization:await ct(),Accept:"application/octet-stream","If-None-Match":t?"":c.storage.vencordCloudSyncSettings.syncVersion.toString()})});if(console.debug("vencordCloud/v1/settings response: ",r),r.status===404)return console.info("No settings on the cloud"),e&&h.showToast("Cloud Settings: There are no settings in the cloud."),!1;if(r.status===304)return console.info("Settings up to date"),e&&h.showToast("Cloud Settings: Your settings are up to date."),!1;if(!r.ok)return console.error(`Failed to sync down, API returned ${r.status}`),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (API returned ${r.status}).`),!1;const a=Number(r.headers.get("etag")),n=c.storage.vencordCloudSyncSettings.syncVersion;if(!t&&a<n){e&&h.showToast("Cloud Settings: Your local settings are newer than the cloud ones.");return}const f=await r.arrayBuffer(),l=new TextDecoder().decode(wt(new Uint8Array(f)));return bt(l),c.storage.vencordCloudSyncSettings.syncVersion=a,console.info("Settings loaded from cloud successfully"),e&&h.showToast("Cloud Settings: Your settings have been updated!"),!0}catch(r){return console.error("Failed to sync down",r),h.showToast(`Cloud Settings: Could not synchronize settings from the cloud (${r.toString()}).`),!1}}const{ScrollView:Tt,Button:xt}=m.General,{FormSection:Q,FormInput:$t,FormDivider:we,FormSwitchRow:At,FormRow:It,FormLabel:Jt}=m.Forms;i.stylesheet.createThemedStyleSheet({delete:{color:V.rawColors.RED_400}});function Nt(){return{authenticated:!1,backendUrl:"https://api.vencord.dev/",syncVersion:0,vencordCloudSecret:{}}}function Pt(){return c.storage.vencordCloudSyncSettings===void 0&&(c.storage.vencordCloudSyncSettings=Nt()),Y.useProxy(c.storage),i.NavigationNative.useNavigation(),React.createElement(Tt,null,React.createElement(Q,null,React.createElement(At,{label:"Enable Cloud Integrations",value:c.storage.vencordCloudSyncSettings.authenticated,onValueChange:function(e){e?lt():c.storage.vencordCloudSyncSettings.authenticated=e},subLabel:"This will request authorization if you have not yet set up cloud integrations."})),React.createElement(Q,null,React.createElement(we,null),React.createElement($t,{value:c.storage.vencordCloudSyncSettings.backendUrl,onChange:function(e){return c.storage.vencordCloudSyncSettings.backendUrl=e},title:"Backend URL"})),React.createElement(Q,null,React.createElement(we,null),React.createElement(It,{label:"This will overwrite your local settings with the ones on the cloud. Use wisely!"}),React.createElement(xt,{title:"Sync from Cloud",disabled:!c.storage.vencordCloudSyncSettings.authenticated,onPress:function(){console.debug("Sync from Cloud pressed"),Ft(!0,!0)}},"Sync from Cloud")))}const{ScrollView:Ut,TextInput:Mt}=m.General,{FormRow:Re,FormSection:Ce,FormDivider:Ee}=m.Forms,be=i.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:i.constants.Fonts.PRIMARY_MEDIUM,color:V.semanticColors.TEXT_NORMAL},placeholder:{color:V.semanticColors.INPUT_PLACEHOLDER_TEXT}}),zt=T.findByName("useIsFocused");function kt(){const[e,t]=i.React.useState("");let r=c.storage.rules;Y.useProxy(c.storage);const a=i.NavigationNative.useNavigation();zt();const n=function(){e&&(r.push({name:e.trim(),match:"",flags:"gi",replace:"",regex:!1}),t(""),a.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return i.React.createElement(de,{ruleIndex:r.length-1})}}))},f=function(){a.push("VendettaCustomPage",{title:"Vencord TextReplace Cloud Sync",render:function(){return i.React.createElement(Pt,null)}})};return i.React.createElement(Ut,null,i.React.createElement(Ce,null,i.React.createElement(Re,{label:"Vencord TextReplace Cloud Sync Settings",onPress:f}),i.React.createElement(Ee,null)),i.React.createElement(Ce,{title:"Rules"},r.map(function(l,g){return i.React.createElement(i.React.Fragment,null,i.React.createElement(tt,{rule:l,index:g}),i.React.createElement(Ee,null))}),i.React.createElement(Re,{label:i.React.createElement(Mt,{value:e,onChangeText:t,placeholder:"New rule",placeholderTextColor:be.placeholder.color,selectionColor:i.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:n,returnKeyType:"done",style:be.input}),trailing:i.React.createElement(He,{onPress:n})})))}let Fe;var _t={onLoad:function(){var e;(e=c.storage).rules??(e.rules=[]),Fe=[Je(),Be()]},onUnload:function(){for(const e of Fe)e()},settings:kt};return J.default=_t,Object.defineProperty(J,"__esModule",{value:!0}),J})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.storage,vendetta.ui);
